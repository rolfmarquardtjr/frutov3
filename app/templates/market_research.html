{% extends "base.html" %}

{% block title %}Fruto.IA - Pesquisa de Mercado para {{ idea.title }}{% endblock %}

{% block content %}
<h1 class="mb-4">Pesquisa de Mercado para {{ idea.title }}</h1>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Gerar Nova Pesquisa de Mercado</h5>
                <form id="marketResearchForm">
                    <div class="mb-3">
                        <label for="location" class="form-label">Localização</label>
                        <input type="text" class="form-control" id="location" placeholder="Ex: São Paulo, Brasil">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Opções de Pesquisa</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="competitors" id="optionCompetitors">
                            <label class="form-check-label" for="optionCompetitors">
                                Análise de Concorrentes
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="trends" id="optionTrends">
                            <label class="form-check-label" for="optionTrends">
                                Tendências de Mercado
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="regulations" id="optionRegulations">
                            <label class="form-check-label" for="optionRegulations">
                                Regulamentações
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="generateResearchBtn">Gerar Pesquisa</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="researchResults" class="mt-4" style="display: none;">
    <h2>Resultados da Pesquisa</h2>
    <div id="researchContent" class="card">
        <div class="card-body">
            <!-- O conteúdo formatado será inserido aqui -->
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <h2>Pesquisas Anteriores</h2>
        {% for research in researches %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Pesquisa de {{ research.created_at.strftime('%d/%m/%Y %H:%M') }}</h5>
                <p class="card-text">{{ research.content[:200] }}...</p>
                <button class="btn btn-primary view-research" data-research-id="{{ research.id }}">Ver Completo</button>
                <button class="btn btn-danger delete-research" data-research-id="{{ research.id }}">Excluir</button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Modal para exibir pesquisa completa -->
<div class="modal fade" id="researchModal" tabindex="-1" aria-labelledby="researchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="researchModalLabel">Pesquisa de Mercado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6 id="researchModalLocation"></h6>
                <h6 id="researchModalDate"></h6>
                <hr>
                <div id="researchModalContent" class="mt-3">
                    <!-- O conteúdo formatado será inserido aqui -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Adicione este modal no final do arquivo, antes do bloco scripts -->
<div class="modal fade" id="deleteResearchModal" tabindex="-1" aria-labelledby="deleteResearchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteResearchModalLabel">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir esta pesquisa de mercado?</p>
                <p>Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteResearch">Excluir</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/market_research.js') }}"></script>
{% endblock %}
